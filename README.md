# Data Processing and Scheduler Script

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç (`run.py`) –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å—Ö–æ–¥–∞—Ö –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—è—Ö –∏–∑ JSON-—Ñ–∞–π–ª–æ–≤, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç CPA –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL. –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ APScheduler.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/daniilhavrylov/SalesBrush.git
cd SalesBrush
````

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python -m venv venv
```

3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

* **Windows (CMD):**

```cmd
venv\Scripts\activate
```

* **Windows (PowerShell):**

```powershell
venv\Scripts\Activate.ps1
```

* **Linux/macOS:**

```bash
source venv/bin/activate
```

4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=your_db_name
DB_HOST=localhost
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å JSON-—Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏:

* `spend.json` ‚Äî —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
* `conv.json` ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º

–§–æ—Ä–º–∞—Ç –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:

```json
[
    {
        "date": "YYYY-MM-DD",
        "campaign_id": "campaign_1",
        "spend": 123.45
    }
]
```

–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è `conversions` —Å –ø–æ–ª–µ–º `"conversions"`.

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞

```bash
python run.py --start-date 2025-12-01 --end-date 2025-12-02
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

* `--spend-file` ‚Äî –ø—É—Ç—å –∫ JSON —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `spend.json`)
* `--conv-file` ‚Äî –ø—É—Ç—å –∫ JSON —Å –∫–æ–Ω–≤–µ—Ä—Å–∏—è–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `conv.json`)
* `--start-date` ‚Äî –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
* `--end-date` ‚Äî –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ü—Ä–∏–º–µ—Ä:

```bash
python run.py --spend-file data/spend.json --conv-file data/conv.json --start-date 2025-12-01 --end-date 2025-12-31
```

---

## ‚è±Ô∏è –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `update_data` —á–µ—Ä–µ–∑ APScheduler —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 80% –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –¥–µ–Ω—å.

---

## üõ†Ô∏è –õ–æ–≥–∏

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

* –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
* –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

---

## ‚ö° –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ `pip install -r requirements.txt`.

---

## üîß –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–∞.
* –î–ª—è –±–æ–ª—å—à–∏—Ö JSON-—Ñ–∞–π–ª–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `execute_batch` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

---

### üîπ –ß–µ–∫-–ª–∏—Å—Ç ¬´—á—Ç–æ –±—ã —è —É–ª—É—á—à–∏–ª, –±—É–¥—å –µ—â—ë +2 –¥–Ω—è¬ª

* [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **Dockerfile / –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—é** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–æ–≤
* [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å **docker-compose** —Å –±–∞–∑–æ–π –∏ —Å–∫—Ä–∏–ø—Ç–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
* [ ] –î–æ–±–∞–≤–∏—Ç—å **—Ç–∏–ø–∏–∑–∞—Ü–∏—é (`mypy`)** –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∏–ª—è –∫–æ–¥–∞ —á–µ—Ä–µ–∑ **`ruff` / `pre-commit`**


